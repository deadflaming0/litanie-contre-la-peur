(ns litanie-contre-la-peur.key-derivation-test
  (:require [clojure.test :refer :all]
            [litanie-contre-la-peur.key-derivation :as key-derivation]))

(def L 112)

(deftest dkm
  (testing "with sha224, taking 112 msb"
    (is (= "960c57ca0be8d23820d7b14b8eff"
           (key-derivation/dkm :sha224
                               "7c0afe78a0767607d3574f4d7c2fb4ce926c5c0fa444b5bdfa81aa54797f59f2e88fc1406e3745ebb5908fb1940db1346d135307aaee4a37e915b6c144a780650778479acef6dda2b57a125f9031c02eb050283654dcd6ac3d4256acdf22244d5e97d096b9d584d15588a0ff1f50ef8bcbb1c61caa0d8814e7c946598755ea2e3c635af371bbc336cb9a672677c7490068428cd7589584d1fa62968a73b431eae9f12ac3fd9e877017b8b132e2b88c733972720eaa9368e90e8d455b75ecad474ae289b5ce542ca7cf1b779141bce7969b44abedb1a4c403eb1f2a3c73d14e095c3c04b9456ce2b2536918a9c0e46b9b0b921a0dd3fef91e4d3fe76a1f564d62"
                               {:L L
                                :other-info "a1b2c3d4e5434156536964acc52fc4b92d85568b602fcc0e6c963a14a34f"})))

    (is (= "11f4f1eddc6d37d44898e47f53ed"
           (key-derivation/dkm :sha224
                               "07cbadaa75f997184bc3549b40c9ef16d7f623cb70a9a29ae458e65c11f16fe6b935a4ca471dfc1a95ec7e7c96522402fb7836d8aac4ce7b8fa97f9b089ea231e9999794184aaad6c822249d35787e5ff25f56b12d29040a58df278ac9c4c648bc3415853db86066112fa8777c6e780fc0b5b4b38ddaf61e050a08139075962197ef9061ab2b706859b04e7532bd683b2015035351052d7b5cce682cd1f238f09043cf512633bc0de8fd811a969c13cf0815727dd2af0bfc7a169594491acb9d266212ef4760a65a2e553dde630270db615a6264aff1e5e52a92af87b8680752d07bce62ce67e6171e15733a195831cc55e08b38ccb19aedaccbf001e319b2f8"
                               {:L L
                                :other-info "a1b2c3d4e543415653696454b352ada4966a60da4c898912cada73fd50af"})))

    (is (not= "cb4e85c396fda4b128c15cb7e33c" ;; > Result = F (6 - DKM changed)
              (key-derivation/dkm :sha224
                                  "2d5af14556673bc628cb9f5ef92f212894fbeab9362ca72bebe59e1df05f625d610ac8ba0a11fe2c535cb2454ecac5592bd1b76eaeb2de5ca11eeb4f39d0e5fb20b712bd898ec63e3704db968bdb6f4137daeeb856c46ee59c077e1e62af6bd63059c63b88cae6c51eb41036c6812580f3a49e856dc9307a7e5e1d66c97bd8bcc4250710e990c7e9e8db7a4fcc46d5848bcd23fd61645fdeff5652ca4e0fcffa4ec97838d9550fbde2a0aa4167fb0ea70ead3a3328e8c2d59225e1e68be33858bb3305d14e3fc4da68960657e12aa8fd5a0b4d294b59ace80a12fd03598e087096cdea770a790a1ad7da3afdb0c585e7a0706e87104a4b426aec4c1e327cc219"
                                  {:L L
                                   :other-info "a1b2c3d4e54341565369644ec2ee3d87f5f685d4e002377affb04f0fe459"})))

    (is (= "9d339cb73c61260369061c96fbbf"
           (key-derivation/dkm :sha224
                               "2fd9c8fad6ef4b77fa50151b0b382b3d0733f28aad04eddb404a13b1a8de287b08863e49ceae10b4662510a3b57306282b982169991e3ddf9c7c7d92c71b6d522a4e95441088196f5ff45a87b297c45312e323cf4d0db7dcbc31f0a062974ff2c934f8c9aab4204525432846b54f31cf0329c5c6a7b903e941ede98d38b28dd057deafca4bd85ae4865b7b9469370725bc71267da3bb4d8be0490830ee3705a62ddc79ed71914e1f651666a3173094b07bbfe0315fc62c9f2a75dc5fcaedd68f9f2db5f927c8cf3d40143a8d4491e509303a71a0a280dc95da0e21a9993369716e5c1c3374b732c3d27d3eff2239e434ea1f209b20c896628456994275f08a76"
                               {:L L
                                :other-info "a1b2c3d4e5434156536964d68f32d48132a5a7c4710a5564d55259fe552e"})))

    (is (not= "de2f2a16e216297004a2e9e1eec4" ;; > Result = F (7 - OI changed)
              (key-derivation/dkm :sha224
                                  "2d5617589672e41eea39a83219715128d5f50c689b793bf8ebbde916427e17b96856c92649db5873881b982165da8fab50b0f1c8216e3f4cf22cff75b50dd47d2147d91053ada7bd12f33142eca91566cdb6c757df74c82badab1964dc81ef907d92c1fe887b60720807070c1f1a28bcd0e0022526171598d1a791323b83972ea645afc7664aebb520e478da1925baeae2dcc3af0e055e07a825143cb3af7a2e36566852309d5f85e3cc81d184d763b3ea3687f9b0827a200bf188d8bd0ccf0cd133e1c8d3e038c92368663f1d968840cdc211d0c4c4c05fe4e26aaad8c48e22cd834479ee4ad775c5bc20659555f4048f5ec4c97202e8402042d1dbb9d2258b"
                                  {:L L
                                   :other-info "a1b2c3d4e5434156556964c0525e228ecf70957c7180b94f7b1df4a79a8b"})))

    (is (= "034e80c8417f598aa4997b317ccc"
           (key-derivation/dkm :sha224
                               "688ff6fbdeba8998f2e1a5f0e9178928124fe60f725273acd1e7035f6163d697c11f47881b8dedc1d305b730fcd95b11d346c59945ca74d27be635cca68343cc04becdc1bfc9c83bf14241df0431abd20ca4fc9f229c1dc82c4001c5a60c1aceeeb28f9ba9d872346d7a1adc5341d003632df028d3af0edd0f54623fde9a48eea0bbf026d5790b4335e662a1b4fa20407503a51762728714639b9deacf3741ba14aaa68f5e993a062f847cb26889dc96dd44dcb8472d5a2b38fdf19c8f63e0aa6e270bca27d9cb1180ed472cf336ed756901e603dc077614ce82bee268b3a6f5d93ac1da9d9a1adfc83fb0d497bb40cf5d87964f5ea1701c6c46f51363e32d98"
                               {:L L
                                :other-info "a1b2c3d4e54341565369646725e955d8252df7e3772681254d0bde30078d"})))

    (is (= "015a6f56d547465d3320304a36f4"
           (key-derivation/dkm :sha224
                               "0102cac3468811c0704cfbce43775fc42058d43ee2e42cbb9631f8ce977df74d30fee779a2ab4ca7a946c575cf74f47212e04c9c7c938551194431753b0a9a8dd79028ac967076bbb84df23a5d2562232d42f19f8d8533fa15d20d5ac0c03a4ee46b0609ae35a0dc0a2b7aba3de21c51d2dbc53ee91dac7e30d603517777e76eb6c18592337c374fe014d42c3e950878ca4115a163fe0995fca2f9f8d64dbabb96a9984fd10cde9fae6dcb1f223993ad019157015b8de4612abe2d9dd39487e1de7c6f456b02e2c905f795d506373ef5bab3405ea0e67e8db4d5b2c9733effb49a5bd6e0ecdeba678ccfc7b07a77bad59ba09b7ac2f70f38c8fd073802389c12"
                               {:L L
                                :other-info "a1b2c3d4e5434156536964e2fc977d57181ab4b43a45ba49c7ffaf467b20"})))

    (is (not= "2255f9a45280143cbba3ce47436c" ;; > Result = F (6 - DKM changed)
              (key-derivation/dkm :sha224
                                  "6779fabfff47e84f1bc99522b7e786e05e1e60d69624bb6d26dfc24ef87fa57d1d62bc608064687a00aa9b1b2b7d98c2aeebc34b616c0dcdbc01abb8a157808d57e2004817c47d4fd4d0cea3d165d679164b7ab9e5e9c4e2c858545bfb05d50ed939cd0b46235906b7cb69f4d29b06977e3e938c7fbb6e6600c6722ce18eb87b357818e29dd77763bed7f9efd8d0fec59020739dfb2e561bb5c2aab1ef3e76187ae10e5720640879d52e627f840d7c7f60ef7ba1bed42d52f4092d3720a076272147072c4bd9947741c33a66511b28c5edec73e9bc84f7d4ae8eab150cdb12042ebf5c25ac68dc957688f2c632b7affb91e478cebc49e146902bf69752f51af6"
                                  {:L L
                                   :other-info "a1b2c3d4e543415653696432afaa98a1bdaf3213e5fb462fc5008d9ef24d"})))

    (is (= "e1ce500b29c34633568af95e4cc0"
           (key-derivation/dkm :sha224
                               "06ca444a819dd96a8ff2aaefd540cee712b986a7b7a1dd9fed6c280116f095557e42f70b3d145921645c2f712c03b083273ae68a1641a4606b0f8d62da0310262783a4a0ccb3d3db53b84b3109e0385699a2a6da669a24eba48c9063da97ec890bcdbd53a7b7c62429a56b2c64fae5d1cd666a1b733a7106712c15ee269fad0337af9cbcdacc0c4839753cc1dd37c300f81e0c9e0a47fc7689d329aac24ede716de36683ebe523fad7da8010452186986cea8d1123e89db304c344116c3e9b2ae973d46e8fcf6151f6268ae52d3a3fbd23fe9bd7384f7fc651a4211d50977fdb9f7024af8b46253983bdeb4142a20454b00c5127e09b1cbab392d4e9a5855a68"
                               {:L L
                                :other-info "a1b2c3d4e54341565369648ca5be75c0408d6de2f45e6dc7d54b38f7dbba"})))

    (is (= "f757283514df4766f04be7d6542d"
           (key-derivation/dkm :sha224
                               "90b7df6f18eca1a3e98a3b7c0f2cb19ddcdc5e5ad3cc514f8e797da39c17ce118bf160b80a50ca66450dafcaae73f175190f9ef63bf1d398fe76e6d8e2fff2551c984a9ba01251be9e80ee4118287968a7a948ce21983f079fd180bcb7bf48cb85250b136b50f3d29464c01c3e53a478e1c09d2b1ca8ddfac626df9ef3f4050ba5de6b03b426cfc1bc55d9b1f8fc4cbc0f726a4f09c5bab2ebd77d0d99f71e565bb74fc753ef9707d5d70fa22d41d65fee8f6506c7793b01fbc4689200593a17c42879d29637019412a54482b1e8c5cd30058c47707760db9ccdfe063ad10d404deda55f50ba8671ee9d10b91d76ed61f843aa99f5ad336049f91baecc75106f"
                               {:L L
                                :other-info "a1b2c3d4e54341565369648d5d83029bc1f02d07f52949a39917294141d4"}))))
  (testing "with sha256, taking 112 msb"
    (is (not= "ae6dacfedd75234df7823c3fb055" ;; > Result = F (6 - DKM changed)
              (key-derivation/dkm :sha256
                                  "6c72d1f53de4e77d370e86d4880ecf4b63f912cbf2c40a615ac3d35ae25c7094da9b596e23a7f5ffd10ff262fed3fb34b661b31bd08be5897e9ea0bc83b7c47fb34e52251223799810c7cf52c72b9afb8c2c9b44fbb5000315de59b6458e2f6ab8d74af35b76180620165a5b6199b829cac57136fc57d8ce1881747177df4421d1a3ea072bdff3f8bacc261f4fbb138b94e37a337c34f3315992e31aabd5c7ee800371c2b7fa60a73f9a3941d7872cf7c312ec0043630647b3c4b77e7729f4aaf79c53d7b74c2c49c2d4b8b9cc90ef6de2f291e35ea94780243b97d8edc1340573ae7e3b863c4b878056ca97d5078fadace15f8a2586451b6449eee28600d419"
                                  {:L L
                                   :other-info "a1b2c3d4e54341565369643516ea36674936e5e66a38ede17b3b80975113"})))

    ;; WTF???
    ; (is (not= "f004b1ee7465f2f1316b30552466" ;; Result = F (5 - Z changed)
    ;           (key-derivation/dkm :sha256
    ;                               "adda84693e2b2183fc5bc25198b4efa099f8d9144e32539154a62734f98ae55013876ad3fb40ae51d37b2781a40a3cbe30d626f660667742a670ad8d6857b195c4960fa787f34a8a4c102adfe707279f9b33a6844495091aef5475ef1029e473857063ed130797f8d66f9beefb198f92381153758d7a631a38ee6c83a03592eda823f464cf64978606a0170323a39f11ed0610153389ffbc6dc9e6da518d56f4dc2ee804728327e6b17a0939f9df76eeefd178ddc8bf3db635ca81a669f42b25029d7d5485a2acc77155065d90625f1cbc37d3ccc48620ba73bf815c80557c4a91b13cb994ffdf49d0d74101e173cb6bde86cd0303b6781a068041216944b472"
    ;                               {:L L
    ;                                :other-info "a1b2c3d4e5434156536964645f0870821ccb75c4a49052e749ae1494aa9a"})))

    (is (= "0a042bf6885acbfdc28924df0a37"
           (key-derivation/dkm :sha256
                               "aefb41e860887fcd4a3aa16f1a1d82136397b14f8fbdebf68787e04751caa4b1a0ce57946918592c25c8261b80a7a85c3f2e6c1e3288e005093134c212d3797f11fe77963a6c7c9c93a33149db1219d0744fc0702b56b29e8c1b7e94305aa8d3c68401cae1d31ec6c727cd2b5c58e6adacc65850e4ac320952ca31402344e361d5abb282e78e396f3a89efa416392fa99a12834e02e1ff5601bdde48c333405ae40daec3814246221378af3d2413626b53777409ccbe706bcb4dcf50208b2e4c895503f3ebb534b197e17abbd9db2e85b8137c7f4928b884ea5cbe3a25d3483cebe252caeda0004aeb5b32721841ed4eb7c794246c03f6ca0907575215c27955"
                               {:L L
                                :other-info "a1b2c3d4e5434156536964cdad953679a8e2d06304c39232993cbc36483d"})))
    ))

(run-tests)
